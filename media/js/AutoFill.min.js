/*
 * File:        AutoFill.min.js
 * Version:     1.0.0
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * 
 * Copyright 2010 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD (3 point) style license, as supplied with this software.
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
var AutoFill;
(function(d){AutoFill=function(b,a){if(!this.CLASS||this.CLASS!="AutoFill")alert("Warning: AutoFill must be initialised with the keyword 'new'");else if(d.fn.dataTableExt.fnVersionCheck("1.7.0")){this.s={filler:{height:0,width:0},border:{width:2},drag:{startX:-1,startY:-1,startTd:null,endTd:null,dragging:false},aiColumns:[]};this.dom={table:null,filler:null,borderTop:null,borderRight:null,borderBottom:null,borderLeft:null,currentTarget:null};this.fnSettings=function(){return this.s};this._fnInit(b,
a);return this}else alert("Warning: AutoFill requires DataTables 1.7 or greater - www.datatables.net/download")};AutoFill.prototype={_fnInit:function(b,a){var c=this;this.s.dt=b.fnSettings();this.dom.table=this.s.dt.nTable;if(typeof a!="undefined"&&typeof a.aiColumns!="undefined")this.s.aiColumns=a.aiColumns;else{b=0;for(a=this.s.dt.aoColumns.length;b<a;b++)this.s.aiColumns.push(b)}b=document.createElement("div");b.className="AutoFill_filler";document.body.appendChild(b);this.dom.filler=b;b.style.display=
"block";this.s.filler.height=d(b).height();this.s.filler.width=d(b).width();b.style.display="none";a=document.createElement("div");a.className="AutoFill_border";document.body.appendChild(a);this.dom.borderTop=a;a=document.createElement("div");a.className="AutoFill_border";document.body.appendChild(a);this.dom.borderRight=a;a=document.createElement("div");a.className="AutoFill_border";document.body.appendChild(a);this.dom.borderBottom=a;a=document.createElement("div");a.className="AutoFill_border";
document.body.appendChild(a);this.dom.borderLeft=a;d(b).mousedown(function(e){this.onselectstart=function(){return false};c._fnFillerDragStart.call(c,e);return false});d("tbody>tr>td",this.dom.table).live("mouseover mouseout",function(e){c._fnFillerDisplay.call(c,e)})},_fnTargetCoords:function(b){var a=b.parentNode;return{x:d("td",a).index(b),y:d("tr",a.parentNode).index(a)}},_fnUpdateBorder:function(b,a){var c=this.s.border.width,e=d(b).offset(),f=d(a).offset();b=e.left-c;var j=f.left+d(a).outerWidth(),
g=e.top-c,k=f.top+d(a).outerHeight(),h=f.left+d(a).outerWidth()-e.left+2*c;a=f.top+d(a).outerHeight()-e.top+2*c;c=this.dom.borderTop.style;c.top=g+"px";c.left=b+"px";c.height=this.s.border.width+"px";c.width=h+"px";c=this.dom.borderBottom.style;c.top=k+"px";c.left=b+"px";c.height=this.s.border.width+"px";c.width=h+"px";c=this.dom.borderLeft.style;c.top=g+"px";c.left=b+"px";c.height=a+"px";c.width=this.s.border.width+"px";c=this.dom.borderRight.style;c.top=g+"px";c.left=j+"px";c.height=a+"px";c.width=
this.s.border.width+"px"},_fnFillerDragStart:function(){var b=this,a=this.dom.currentTarget;this.s.drag.dragging=true;b.dom.borderTop.style.display="block";b.dom.borderRight.style.display="block";b.dom.borderBottom.style.display="block";b.dom.borderLeft.style.display="block";var c=this._fnTargetCoords(a);this.s.drag.startX=c.x;this.s.drag.startY=c.y;this.s.drag.startTd=a;this.s.drag.endTd=a;this._fnUpdateBorder(a,a);d(document).bind("mousemove.AutoFill",function(e){b._fnFillerDragMove.call(b,e)});
d(document).bind("mouseup.AutoFill",function(e){b._fnFillerFinish.call(b,e)})},_fnFillerDragMove:function(b){if(b.target&&b.target.nodeName.toUpperCase()=="TD"&&b.target!=this.s.drag.endTd){var a=this._fnTargetCoords(b.target);if(a.x!=this.s.drag.startX){b.target=d("tbody>tr:eq("+a.y+")>td:eq("+this.s.drag.startX+")",this.dom.table)[0];a=this._fnTargetCoords(b.target)}if(a.x==this.s.drag.startX){var c=this.s.drag;c.endTd=b.target;a.y>=this.s.drag.startY?this._fnUpdateBorder(c.startTd,c.endTd):this._fnUpdateBorder(c.endTd,
c.startTd);this._fnFillerPosition(b.target)}}},_fnFillerFinish:function(){d(document).unbind("mousemove.AutoFill");d(document).unbind("mouseup.AutoFill");this.dom.borderTop.style.display="none";this.dom.borderRight.style.display="none";this.dom.borderBottom.style.display="none";this.dom.borderLeft.style.display="none";this.s.drag.dragging=false;var b=this._fnTargetCoords(this.s.drag.startTd),a=this._fnTargetCoords(this.s.drag.endTd),c=[],e;if(b.y<=a.y){e=true;for(i=b.y;i<=a.y;i++)c.push(d("tbody>tr:eq("+
i+")>td:eq("+b.x+")",this.dom.table)[0])}else{e=false;for(i=b.y;i>=a.y;i--)c.push(d("tbody>tr:eq("+i+")>td:eq("+b.x+")",this.dom.table)[0])}b=this._fnPrep(this._fnReadCell(this.s.drag.startTd));a=false;i=0;for(iLen=c.length;i<iLen;i++){if(i==iLen-1)a=true;this._fnWriteCell(c[i],this._fnStep(b,i,e),a,a)}},_fnPrep:function(b){var a=b.match(/[\d\.]+/g);if(!a||a.length===0)return{iStart:0,sStr:b,sPostFix:""};var c=a[a.length-1];a=parseInt(c,10);var e=new RegExp("^(.*)"+c+"(.*?)$");c=c.match(/\./)?"."+
c.split(".")[1]:"";return{iStart:a,sStr:b.replace(e,"$1SPRYMEDIA_AUTOFILL_STEPPER$2"),sPostFix:c}},_fnStep:function(b,a,c){a=c?b.iStart+a:b.iStart-a;if(isNaN(a))a="";return b.sStr.replace(/SPRYMEDIA_AUTOFILL_STEPPER/,a+b.sPostFix)},_fnReadCell:function(b){var a=d("input",b);if(a.length>0)return d(a).val();a=d("select",b);if(a.length>0)return d(a).val();return b.innerHTML},_fnWriteCell:function(b,a,c){var e=d("input",b);if(e.length>0)d(e).val(a);else{e=d("select",b);if(e.length>0)d(e).val(a);else{b=
this.s.dt.oInstance.fnGetPosition(b);this.s.dt.oInstance.fnUpdate(a,b[0],b[2],c,c)}}},_fnFillerDisplay:function(b){if(!this.s.drag.dragging)if(!(d.inArray(this._fnTargetCoords(b.target).x,this.s.aiColumns)<0)){var a=this.dom.filler;if(b.type=="mouseover"){this.dom.currentTarget=b.target;this._fnFillerPosition(b.target);a.style.display="block"}else if(!b.relatedTarget||!b.relatedTarget.className.match(/AutoFill/))a.style.display="none"}},_fnFillerPosition:function(b){var a=d(b).offset(),c=this.dom.filler;
c.style.top=a.top-this.s.filler.height/2-1+d(b).outerHeight()+"px";c.style.left=a.left-this.s.filler.width/2-1+d(b).outerWidth()+"px"}};AutoFill.prototype.CLASS="AutoFill";AutoFill.VERSION="1.0.0";AutoFill.prototype.VERSION="1.0.0"})(jQuery);
